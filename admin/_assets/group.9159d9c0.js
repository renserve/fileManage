let e=document.createElement("style");e.innerHTML=".wrapper .item{padding:20px;border-bottom:1px solid #e9e9e9}.wrapper .item:last-child{border:none}.wrapper .item .title{padding-bottom:20px}",document.head.appendChild(e);import{cO as t,cF as a,d3 as i,a as s,dg as l,dh as o,di as r,dj as n,J as d,db as c,h,g as p,dk as m,dl as u,dm as g,dn as b,r as k,o as f,b as w,n as j,w as v,m as C,v as _,q as y,aA as A,b8 as D}from"./index.7ca95812.js";import"./useFullScreen.f60bfff3.js";import"./index.820c583e.js";import{a as x,u as L}from"./index.d6dca0ee.js";import"./index.d101ee26.js";import"./index.3e791ece.js";import"./zh_CN.0242bd16.js";import"./CheckOutlined.da4747b4.js";import{s as M}from"./useTable.a18bfa4b.js";import"./upload.a2665367.js";import{b as O}from"./_baseDifference.fc2c826e.js";import{g as S,a as R,u as T}from"./useTable.3ce64512.js";import"./index.6d254475.js";import"./useWindowSizeFn.f7593b16.js";import"./domUtils.a209b89e.js";import B from"./Dialog.841555ee.js";import{g as z}from"./tableData.909006fb.js";var E=t((function(e,t){return a(e)?O(e,i(t,1,a,!0)):[]})),G=s({components:{BasicModal:x,BasicTable:M,Dialog:B},data:()=>({group_id:null,hadCheckedList:[],checkedList:[[],[],[]],indeterminate:[!1,!1,!1],checkAll:[!1,!1,!1]}),methods:{onChange(e,t){const a=this.permissionGroup[t].children;this.checkAll[t]=e.length===a.length,this.indeterminate[t]=!!e.length&&e.length<a.length},onCheckAllChange(e,t){this.checkedList[t]=e.target.checked?this.permissionGroup[t].children:[],this.indeterminate[t]=!1},async dispatchBatch(){const e=l(this.checkedList),t=E(e,this.hadCheckedList),a=E(this.hadCheckedList,e);a.length&&await o({group_id:this.group_id,auths:a}),t.length&&await r({group_id:this.group_id,auths:t}),this.closeModal()},dispatchModal(e){this.group_id=e,n(e).then((e=>{const t=e.auths.map((e=>Object.values(e)[0])).map((e=>e.map((e=>e.auth))));this.hadCheckedList=l(t);const a=l(e.auths.map((e=>Object.keys(e)[0])));this.permissionGroup.map(((e,i)=>{const s=a.findIndex((t=>e.label===t));if(s>-1){const a=t[s].length;this.indeterminate[i]=!!a&&e.children.length!==a,this.checkAll[i]=e.children.length===a,this.checkedList[i]=t[s]}else this.checkAll[i]=!1,this.indeterminate[i]=!1,this.checkedList[i]=[]}))})),this.openModal()}},setup(e,t){d("schemas",S(z));const a={fetchSetting:{listField:null},pagination:!1,api:c,title:"分组",columns:R(z)},i=h({id:null,append:"分组",title:"新增分组"}),s={rowSaveApi:u,rowEditApi:g,rowDeleteApi:b};let l=p([]);m().then((e=>{l.value=Object.keys(e).map(((t,a)=>({label:t,value:a,children:Object.keys(e[t])})))}));const[o,{openModal:r,closeModal:n}]=L(),[{registerTable:k},{registerDialog:f},{rowDelete:w,rowSave:j,rowEdit:v,rowAdd:C}]=T({...a,...s,relyObject:i});return{register:o,closeModal:n,openModal:r,permissionGroup:l,registerTable:k,registerDialog:f,rowDelete:w,rowSave:j,rowEdit:v,rowAdd:C,relyObject:i}}});const U=_(" 权限 "),F=_("编辑 "),$=_("删除"),q={class:"item"},H={class:"title"};G.render=function(e,t,a,i,s,l){const o=k("a-button"),r=k("BasicTable"),n=k("a-checkbox"),d=k("a-checkbox-group"),c=k("BasicModal"),h=k("Dialog");return f(),w("div",null,[j(o,{type:"primary",onClick:t[1]||(t[1]=t=>e.rowAdd(e.$refs.Dialog))},{default:v((()=>[_("新增"+y(e.relyObject.append),1)])),_:1}),j(r,{onRegister:e.registerTable},{create_time:v((({record:e})=>[_(y(e.create_time),1)])),operate:v((({record:t})=>[j(o,{class:"mr_btn",size:"small",shape:"round",type:"primary",onClick:a=>e.dispatchModal(t.id)},{default:v((()=>[U])),_:1},8,["onClick"]),j(o,{class:"mr_btn",size:"small",shape:"round",type:"primary",onClick:a=>e.rowEdit(e.$refs.Dialog,t)},{default:v((()=>[F])),_:1},8,["onClick"]),j(o,{size:"small",disabled:1===t.id,shape:"round",type:"danger",onClick:a=>e.rowDelete(t.id)},{default:v((()=>[$])),_:2},1032,["disabled","onClick"])])),_:1},8,["onRegister"]),j(c,C(e.$attrs,{onRegister:e.register,onOk:t[2]||(t[2]=t=>e.dispatchBatch()),class:"wrapper",width:"50vw",title:"权限分配"}),{default:v((()=>[(f(!0),w(A,null,D(e.permissionGroup,(t=>(f(),w("div",q,[j("div",H,[j(n,{checked:e.checkAll[t.value],"onUpdate:checked":a=>e.checkAll[t.value]=a,indeterminate:e.indeterminate[t.value],onChange:a=>e.onCheckAllChange(a,t.value)},{default:v((()=>[_(y(t.label),1)])),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange"])]),j(d,{value:e.checkedList[t.value],"onUpdate:value":a=>e.checkedList[t.value]=a,options:t.children,onChange:a=>e.onChange(a,t.value)},null,8,["value","onUpdate:value","options","onChange"])])))),256))])),_:1},16,["onRegister"]),j(h,{ref:"Dialog",onRowSave:e.rowSave,title:e.relyObject.title,onRegister:e.registerDialog},null,8,["onRowSave","title","onRegister"])])};export default G;
