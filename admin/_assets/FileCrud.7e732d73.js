let e=document.createElement("style");e.innerHTML=".loadMoreWrap[data-v-4e15ed8c]{margin-bottom:50px}[data-v-4e15ed8c] .collapse-container__body{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}[data-v-4e15ed8c] .collapse-container__body form{max-width:880px;-webkit-box-flex:1;-ms-flex:1;flex:1;margin-right:100px}[data-v-4e15ed8c] .collapse-container__body button{-webkit-box-flex:0;-ms-flex:0;flex:0}",document.head.appendChild(e);import{n as t,m as a,aL as i,a as l,g as s,J as o,h as r,c as n,k as c,bh as d,p,l as u,r as m,o as f,b,e as h,v as g,q as y,aA as v,a9 as w,aa as D,s as j}from"./index.7ca95812.js";import"./useFullScreen.f60bfff3.js";import{B as x,u as O}from"./index.820c583e.js";import"./index.d6dca0ee.js";import"./index.d101ee26.js";import"./index.3e791ece.js";import"./zh_CN.0242bd16.js";import{C as S}from"./index.c5ca15aa.js";import"./CheckOutlined.da4747b4.js";import{s as _}from"./useTable.a18bfa4b.js";import{r as k,d as F,a as R,g as L,e as C,s as P,f as T,h as $,b as E,u as z}from"./upload.a2665367.js";import{s as A,c as B}from"./FileTree.e08d7fa1.js";import"./_baseDifference.fc2c826e.js";import{g as M,u as H}from"./useTable.3ce64512.js";import"./index.6d254475.js";import"./useWindowSizeFn.f7593b16.js";import"./useCopyToClipboard.98c745a1.js";import"./domUtils.a209b89e.js";import I from"./Dialog.841555ee.js";import q from"./SourceList.f66d00d5.js";var W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};function V(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var G=function(e,l){var s=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),i.forEach((function(t){V(e,t,a[t])}))}return e}({},e,l.attrs);return t(i,a(s,{icon:W}),null)};G.displayName="DeleteOutlined",G.inheritAttrs=!1;var N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"};function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var J=function(e,l){var s=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),i.forEach((function(t){U(e,t,a[t])}))}return e}({},e,l.attrs);return t(i,a(s,{icon:N}),null)};J.displayName="RollbackOutlined",J.inheritAttrs=!1;const{createWarningModal:K,createConfirm:Q}=c();var X=l({props:["type","title","maxSize","accept"],components:{BasicForm:x,CollapseContainer:S,FileTree:A,Dialog:I,BasicTable:_,RollbackOutlined:J,DeleteOutlined:G,SourceList:q},data:()=>({isRecycle:0}),methods:{loadMore(){this.sendData.page+1<this.totalPage&&this.sendData.page++,this.reloadFileList(!1)},batchRecover(){const e=this.$refs.SourceList.getSelect(),t=this;e.length?Q({iconType:"warning",title:`确认批量恢复选中的${this.title}？`,onOk(){k(t.type,{ids:e}).then((e=>{t.reloadFileList()}))}}):K({content:`请选择需要恢复的${this.title}`})},getDeleteData(){this.isRecycle=this.isRecycle?0:1,this.sendData.isDelete=this.isRecycle,this.reloadFileList()},batchSubmit(){const e=this.$refs.SourceList.getSelect(),t=this;e.length?Q({iconType:"warning",title:`确认批量${this.isRecycle?"清空":"删除"}选中的${this.title}？`,onOk(){F(t.type,{ids:e,isClear:t.isRecycle}).then((e=>{t.reloadFileList()}))}}):K({content:`请选择需要删除的${this.title}`})},getCurrentList(e){const t=/file/.test(e.id),a=t?e.parent_id:e.id;this.setFieldsValue({folder_id:a}),t?this.showFileList=[{path:e.path,id:e.realId,name:e.name,title:e.title}]:(this.sendData.page=0,this.sendData.folder_id=a,this.reloadFileList())},handleSubmit(e){R(this.type,e).then((e=>{e.error_code||(this.resetFields(),this.setFieldsValue({folder_id:this.sendData.folder_id})),this.reloadFileList()}))}},setup(e,t){const a={fetchSetting:{listField:null},pagination:!1,api:t=>C({...t,type:e.type}),title:"分组"},i=s(!1);o("schemas",M([{label:"父类ID",field:"parent_id",width:120,disabled:!0,rules:[{required:!0,message:"请输入父类ID",type:"number"}]},{label:"类型",field:"type",component:"RadioGroup",componentProps:{options:[{label:"图片",value:"img"},{label:"文本",value:"txt"},{label:"音频",value:"audio"},{label:"视频",value:"video"}]},disabled:!0,rules:[{required:!0,message:"请输入文件类型"}]},{label:"文件夹名称",field:"name",rules:[{required:!0,message:"请输入文件夹名称"}]},{label:"文件夹描述",field:"description"}]));const l=r({id:null,initForm:{parent_id:0,type:e.type},title:"新增"}),c={rowSaveApi:P,rowEditApi:T,rowDeleteApi:$},p=s(null),u=s(null),m=s(null),f=s(!1),b=s(!1),h=r({page:0,count:30,folder_id:null,isDelete:0}),g=d();function y(t=!0){t&&(h.page=0),f.value=!0;const a=g.refs.SourceList;a&&a.resetSelect(),L(e.type,h).then((e=>{!h.page&&(p.value=[]),u.value=e.total_page,f.value=!1,p.value=B(p.value,e.items.map((e=>({parent_id:e.folder_id,name:e.path.split("/").pop(),isLeaf:!0,title:e.title,realId:e.id,id:"file_"+e.id,key:"file_"+e.id,path:e.path})))),m.value=p.value.map((e=>({path:e.path,id:e.realId,name:e.name,title:e.title})))})).catch((()=>{f.value=!1}))}o("sendData",h),y();const[{registerTable:v,isInit:w,getDataSource:D},{registerDialog:j},{rowDelete:x,rowSave:S,rowEdit:_,rowAdd:k}]=H({...a,...c,relyObject:l}),F=n((()=>w()&&D())),R=n((()=>{const t=w()&&D()||[];return[{field:"paths",component:"Upload",label:`${e.title}上传`,colProps:{span:8},rules:[{required:!0,message:`请选择${e.title}文件上传`}],componentProps:{maxSize:e.maxSize,accept:i.value?[]:e.accept,uploadParams:{data:{type:e.type}},api:b.value?E:z}},{field:"folder_id",colProps:{span:8},rules:[{required:!0,message:`请选择${e.title}所属文件分类`,type:"number"}],component:"Select",componentProps:{options:t.map((e=>({label:e.name,value:e.id})))},disabled:!0,label:`${e.title}分类`}]})),[A,{setFieldsValue:I,resetFields:q}]=O({labelWidth:130,schemas:R,actionColOptions:{span:8},resetButtonOptions:{text:"重新上传"},submitButtonOptions:{text:"提交文件"}});return{sendData:h,leafData:p,bigfile:b,loading:f,totalPage:u,fileExpand:i,showFileList:m,reloadFileList:y,register:A,setFieldsValue:I,resetFields:q,registerTable:v,treeData:F,registerDialog:j,rowDelete:x,rowSave:S,rowEdit:_,rowAdd:k,relyObject:l}}});const Y=j("data-v-4e15ed8c");p("data-v-4e15ed8c");const Z={class:"imgWrapper"},ee=t("span",null,"类型扩展",-1),te=g("批量恢复"),ae={key:0},ie=g(" 返回 "),le={key:1},se=g(" 回收站 "),oe={class:"loadMoreWrap"},re=g("加载更多...");u();const ne=Y(((e,a,i,l,s,o)=>{const r=m("a-switch"),n=m("a-tooltip"),c=m("BasicForm"),d=m("a-button"),p=m("RollbackOutlined"),u=m("DeleteOutlined"),j=m("CollapseContainer"),x=m("a-alert"),O=m("SourceList"),S=m("FileTree"),_=m("Dialog"),k=m("BasicTable");return f(),b("div",Z,[t(j,{title:e.title+"上传"},{default:Y((()=>[t(n,{placement:"top"},{title:Y((()=>[ee])),default:Y((()=>[t(r,{"checked-children":"开","un-checked-children":"关",checked:e.fileExpand,"onUpdate:checked":a[1]||(a[1]=t=>e.fileExpand=t)},null,8,["checked"])])),_:1}),t(c,{onRegister:e.register,onSubmit:e.handleSubmit},null,8,["onRegister","onSubmit"]),t("div",null,[e.isRecycle?(f(),b(d,{key:0,class:"mr_btn",type:"primary",onClick:a[2]||(a[2]=t=>e.batchRecover())},{default:Y((()=>[te])),_:1})):h("",!0),t(d,{class:"mr_btn",type:"danger",onClick:a[3]||(a[3]=t=>e.batchSubmit())},{default:Y((()=>[g("批量"+y(e.isRecycle?"清空":"删除"),1)])),_:1}),t(d,{type:e.isRecycle?"primary":"default",onClick:a[4]||(a[4]=t=>e.getDeleteData())},{default:Y((()=>[e.isRecycle?(f(),b("div",ae,[t(p),ie])):(f(),b("div",le,[t(u),se]))])),_:1},8,["type"])])])),_:1},8,["title"]),t(S,{leafData:e.leafData,treeData:e.treeData,onCurrentClass:e.getCurrentList,onRowDelete:e.rowDelete,onRowAdd:a[6]||(a[6]=t=>e.rowAdd(e.$refs.Dialog,t)),onRowEdit:a[7]||(a[7]=t=>e.rowEdit(e.$refs.Dialog,Object.assign(e.relyObject.initForm,t)))},{default:Y((()=>[e.leafData?(f(),b(v,{key:0},[e.isRecycle?(f(),b(x,{key:0,message:"当前展示内容为回收站内容",banner:""})):h("",!0),t(O,{type:e.type,ref:"SourceList",gapGroup:e.isRecycle?e.showFileList.length:6,showFileList:e.showFileList},null,8,["type","gapGroup","showFileList"]),w(t("div",oe,[t(d,{loading:e.loading,size:"large",block:"",onClick:a[5]||(a[5]=t=>e.loadMore())},{default:Y((()=>[re])),_:1},8,["loading"])],512),[[D,e.totalPage>e.sendData.page+1]])],64)):h("",!0)])),_:1},8,["leafData","treeData","onCurrentClass","onRowDelete"]),t(_,{ref:"Dialog",onRowSave:e.rowSave,title:e.relyObject.title,onRegister:e.registerDialog},null,8,["onRowSave","title","onRegister"]),t(k,{isFake:!0,onRegister:e.registerTable},null,8,["onRegister"])])}));X.render=ne,X.__scopeId="data-v-4e15ed8c";export default X;
